apiVersion: v1
kind: ConfigMap
metadata:
  name: sas-ldap-ldifs
  labels:
    app.kubernetes.io/part-of: sas-ldap-server
data:
  createDomain.ldif: |
    dn: dc=sasldap,dc=com
    objectClass: top
    objectClass: dcObject
    objectClass: organization
    o: SAS Institute
    dc: sasldap
    l: Italy
    description: SAS Institute base entry
  loadMemberOfModule.ldif: |
    dn: cn=module{0},cn=config
    changetype: modify
    add: olcModuleLoad
    olcModuleLoad: /opt/bitnami/openldap/lib/openldap/memberof.so
  configureMemberOfOverlay.ldif: |
    dn: olcOverlay=memberof,olcDatabase={2}mdb,cn=config
    objectClass: olcOverlayConfig
    objectClass: olcMemberOf
    olcOverlay: memberof
    olcMemberOfDangling: ignore
    olcMemberOfRefInt: TRUE
    olcMemberOfGroupOC: groupOfNames
    olcMemberOfMemberAD: member
    olcMemberOfMemberOfAD: memberOf

    dn: olcDatabase={2}mdb,cn=config
    changetype: modify
    add: olcAccess
    olcAccess: to attrs=memberOf by * read
  readAccessSASbindUser.ldif: | 
    # User - SAS Bind Service Account
    dn: uid=sasbind,dc=sasldap,dc=com
    objectClass: inetOrgPerson
    objectClass: organizationalPerson
    objectClass: person
    objectClass: posixAccount
    objectClass: top
    uidNumber: 1003
    gidNumber: 1003
    uid: sasbind
    cn: sasbind
    givenName: SAS Bind
    sn: Service Account
    displayName: SAS Bind Service Account
    mail: sasbind@sasldap.com
    l: Italy
    o: SAS Institute
    homeDirectory: /home/sasbind
    loginShell: /bin/bash
    userPassword: SAS@ldapB1nd

    dn: cn=config
    changetype: modify
    add: olcAccess
    olcAccess: to attrs=*
      by dn.base="uid=sasbind,dc=sasldap,dc=com" read
      by * none